<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«é€Ÿåˆ†å±æµ‹è¯•</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            text-align: center;
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .screen-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: left;
            font-family: monospace;
            font-size: 14px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            transition: background 0.3s;
        }
        button:hover {
            background: #0056b3;
        }
        .status {
            margin: 15px 0;
            padding: 10px;
            border-radius: 6px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ–¥ï¸ å¿«é€Ÿåˆ†å±æµ‹è¯•</h1>

        <div class="screen-info" id="screenInfo">
            <div>å±å¹•: <span id="screenSize">æ£€æµ‹ä¸­...</span></div>
            <div>å¯ç”¨åŒºåŸŸ: <span id="availSize">æ£€æµ‹ä¸­...</span></div>
        </div>

        <div id="status" class="status info">
            ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æµ‹è¯•å…¨å±åˆ†å±åŠŸèƒ½
        </div>

        <div>
            <button onclick="testSideBySide()">ğŸ”„ å·¦å³åˆ†å±</button>
            <button onclick="testTopBottom()">â¬†ï¸ ä¸Šä¸‹åˆ†å±</button>
            <button onclick="testFocus()">ğŸ¯ ä¸“æ³¨æ¨¡å¼</button>
        </div>

        <div style="margin-top: 20px;">
            <small>æ³¨æ„ï¼šè¿™å°†åˆ›å»ºä¸¤ä¸ªæ–°çª—å£æ¥æµ‹è¯•åˆ†å±å¸ƒå±€</small>
        </div>
    </div>

    <script src="test-screen-api.js"></script>
    <script>
        // æ›´æ–°å±å¹•ä¿¡æ¯
        function updateScreenInfo() {
            const width = screen.availWidth;
            const height = screen.availHeight;

            document.getElementById('screenSize').textContent = `${screen.width} Ã— ${screen.height}`;
            document.getElementById('availSize').textContent = `${width} Ã— ${height}`;
        }

        // æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯
        function showStatus(message, type = 'info') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }

        // åˆ›å»ºæµ‹è¯•çª—å£
        async function createTestWindow(url, width, height, left, top, focused = true) {
            try {
                const window = await chrome.windows.create({
                    url: url,
                    width: width,
                    height: height,
                    left: left,
                    top: top,
                    focused: focused,
                    state: 'normal'
                });
                console.log('åˆ›å»ºçª—å£æˆåŠŸ:', window.id);
                return window;
            } catch (error) {
                console.error('åˆ›å»ºçª—å£å¤±è´¥:', error);
                throw error;
            }
        }

        // æµ‹è¯•å·¦å³åˆ†å±
        async function testSideBySide() {
            try {
                showStatus('æ­£åœ¨åˆ›å»ºå·¦å³åˆ†å±å¸ƒå±€...', 'info');

                const screenWidth = screen.availWidth;
                const screenHeight = screen.availHeight;
                const windowGap = 2;

                const width1 = Math.floor(screenWidth / 2) - Math.floor(windowGap / 2);
                const width2 = Math.floor(screenWidth / 2) - Math.floor(windowGap / 2);
                const left1 = 0;
                const left2 = width1 + windowGap;

                console.log('å·¦å³åˆ†å±å¸ƒå±€:', { width1, width2, left1, left2, height: screenHeight });

                // åˆ›å»ºä¸¤ä¸ªæµ‹è¯•çª—å£
                const window1 = await createTestWindow(
                    'test-fullscreen.html',
                    width1,
                    screenHeight,
                    left1,
                    0,
                    true
                );

                setTimeout(async () => {
                    const window2 = await createTestWindow(
                        'https://www.google.com',
                        width2,
                        screenHeight,
                        left2,
                        0,
                        false
                    );
                    showStatus('âœ… å·¦å³åˆ†å±åˆ›å»ºæˆåŠŸï¼çª—å£å·²é“ºæ»¡æ•´ä¸ªå±å¹•', 'success');
                }, 500);

            } catch (error) {
                showStatus('âŒ åˆ›å»ºå¤±è´¥: ' + error.message, 'error');
                console.error('å·¦å³åˆ†å±æµ‹è¯•å¤±è´¥:', error);
            }
        }

        // æµ‹è¯•ä¸Šä¸‹åˆ†å±
        async function testTopBottom() {
            try {
                showStatus('æ­£åœ¨åˆ›å»ºä¸Šä¸‹åˆ†å±å¸ƒå±€...', 'info');

                const screenWidth = screen.availWidth;
                const screenHeight = screen.availHeight;
                const windowGap = 2;

                const height = Math.floor(screenHeight / 2) - Math.floor(windowGap / 2);
                const top1 = 0;
                const top2 = height + windowGap;

                console.log('ä¸Šä¸‹åˆ†å±å¸ƒå±€:', { width: screenWidth, height, top1, top2 });

                // åˆ›å»ºä¸¤ä¸ªæµ‹è¯•çª—å£
                const window1 = await createTestWindow(
                    'test-fullscreen.html',
                    screenWidth,
                    height,
                    0,
                    top1,
                    true
                );

                setTimeout(async () => {
                    const window2 = await createTestWindow(
                        'https://www.google.com',
                        screenWidth,
                        height,
                        0,
                        top2,
                        false
                    );
                    showStatus('âœ… ä¸Šä¸‹åˆ†å±åˆ›å»ºæˆåŠŸï¼çª—å£å·²é“ºæ»¡æ•´ä¸ªå±å¹•', 'success');
                }, 500);

            } catch (error) {
                showStatus('âŒ åˆ›å»ºå¤±è´¥: ' + error.message, 'error');
                console.error('ä¸Šä¸‹åˆ†å±æµ‹è¯•å¤±è´¥:', error);
            }
        }

        // æµ‹è¯•ä¸“æ³¨æ¨¡å¼
        async function testFocus() {
            try {
                showStatus('æ­£åœ¨åˆ›å»ºä¸“æ³¨æ¨¡å¼å¸ƒå±€...', 'info');

                const screenWidth = screen.availWidth;
                const screenHeight = screen.availHeight;
                const windowGap = 2;

                const width1 = Math.floor(screenWidth * 0.65) - Math.floor(windowGap / 2);
                const width2 = Math.floor(screenWidth * 0.35) - Math.floor(windowGap / 2);
                const left1 = 0;
                const left2 = width1 + windowGap;

                console.log('ä¸“æ³¨æ¨¡å¼å¸ƒå±€:', { width1, width2, left1, left2, height: screenHeight });

                // åˆ›å»ºä¸¤ä¸ªæµ‹è¯•çª—å£
                const window1 = await createTestWindow(
                    'test-fullscreen.html',
                    width1,
                    screenHeight,
                    left1,
                    0,
                    true
                );

                setTimeout(async () => {
                    const window2 = await createTestWindow(
                        'https://www.google.com',
                        width2,
                        screenHeight,
                        left2,
                        0,
                        false
                    );
                    showStatus('âœ… ä¸“æ³¨æ¨¡å¼åˆ›å»ºæˆåŠŸï¼çª—å£å·²é“ºæ»¡æ•´ä¸ªå±å¹•', 'success');
                }, 500);

            } catch (error) {
                showStatus('âŒ åˆ›å»ºå¤±è´¥: ' + error.message, 'error');
                console.error('ä¸“æ³¨æ¨¡å¼æµ‹è¯•å¤±è´¥:', error);
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ›´æ–°ä¿¡æ¯
        window.addEventListener('load', () => {
            updateScreenInfo();

            // æ£€æŸ¥æ˜¯å¦åœ¨æ‰©å±•ç¯å¢ƒä¸­
            if (typeof chrome !== 'undefined' && chrome.windows) {
                showStatus('âœ… æ‰©å±•ç¯å¢ƒæ£€æµ‹æˆåŠŸï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•', 'success');
            } else {
                showStatus('âš ï¸ æœªåœ¨æ‰©å±•ç¯å¢ƒä¸­è¿è¡Œï¼Œéƒ¨åˆ†åŠŸèƒ½å¯èƒ½ä¸å¯ç”¨', 'info');
            }
        });

        // çª—å£å¤§å°å˜åŒ–æ—¶æ›´æ–°ä¿¡æ¯
        window.addEventListener('resize', updateScreenInfo);
    </script>
</body>
</html>